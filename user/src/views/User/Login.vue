<template>
  <div class="login">
    <v-container justify-center  transition="scale-transition">
      <h1>用户登录</h1>
      <v-form ref="login">
        <v-text-field
          v-for="field in formFields"
          v-model="formData[field.key]"
          :key="field.key"
          :label="field.label"
          :rules="field.rules || []"
          :type="field.type || 'text'"
          required
        ></v-text-field>
      </v-form>
      <div class="login_footer">
        <v-btn
          @click="login"
        >登录</v-btn>
      </div>
    </v-container>
  </div>
</template>

<script lang="ts">
import { Component, Vue } from 'vue-property-decorator';
import EventBus, { Event } from '@/utils/EventBus';
import { default as localforage } from 'localforage'
import * as apis from "../../apis/index"

@Component
export default class Login extends Vue {
  formData = {
    username: '',
    password: '',
  }

  formFields = [
    {
      key: 'username',
      label: '用户名',
      rules: [(v: any) => !!v || '请填写用户名'],
    },
    {
      key: 'password',
      label: '密码',
      type: 'password',
      rules: [(v: any) => !!v || '请填写密码'],
    },
  ]

  async login() {
    await (this.$refs.login as any).validate()

    const postFormData: any = new FormData();
    postFormData.set('username', this.formData.username);
    postFormData.set('password', this.formData.password);

    const resp = await apis.postUserLogin(postFormData)

    await localforage.setItem('ignite_token', resp)
    this.$router.push({ name: 'profile' });
  }
}
</script>

<style lang="less">
.login_footer {
  text-align: left;
}
</style>
